# Factory 模块实现

Factory 模块负责池创建和管理，作为在 Cetus CLMM 协议中创建新流动性池的入口点。它实现了基于权限的池创建和全面的池生命周期管理。

## 核心数据结构

### 池管理

`Pools` 结构体维护系统中所有池的注册表：

- **池注册表**：`list` - 将池键映射到简单池信息的链接表
- **索引跟踪**：`index` - 池识别的顺序计数器
- **池标识**：`id` - 池注册对象的唯一标识符

### 池键和权限

该模块实现了复杂的池创建控制：

- **PoolKey**：使用代币类型和刻度间距唯一标识池配置
- **PoolCreationCap**：允许特定代币池创建的能力
- **PermissionPairManager**：管理池创建的允许代币-刻度组合
- **DenyCoinList**：控制哪些代币可以或不可以用于池创建

## 主要特性

### 池创建

工厂通过几种机制启用受控池创建：
- **基于权限的创建**：池创建需要特定能力
- **白名单/黑名单**：控制哪些代币可以参与池创建
- **费用层级验证**：确保刻度间距符合预定义层级
- **池键生成**：为池配置创建唯一标识符

### 访问控制

强大的权限管理确保安全的池创建：
- **基于角色的访问**：池管理员拥有提升的特权
- **基于能力的权限**：对哪些代币可以创建池进行细粒度控制
- **配置验证**：防止无效的池设置
- **管理控制**：用于管理权限的管理功能

### 池生命周期管理

工厂处理完整的池生命周期操作：
- **池注册**：在全局注册表中记录新池
- **池检索**：高效查找现有池
- **池验证**：验证池的存在性和正确性
- **池统计**：维护池计数和元数据

## 实现细节

Factory 模块使用动态对象字段存储复杂的权限结构，从而能够运行时配置允许的池创建模式。它维护单独的跟踪：

1. **允许的代币列表**：哪些代币被允许用于池创建
2. **拒绝的代币列表**：哪些代币被限制用于池创建
3. **权限对配置**：哪些代币组合可以与特定刻度间距一起使用
4. **创建能力**：特定代币类型的个人权限

这种设计允许灵活且安全的池创建，可以由协议管理员管理，同时仍然通过适当的能力管理允许社区驱动的池创建。

该实现还包括全面的事件发射，用于跟踪池创建活动、权限更改和访问控制修改，使其易于监控和审计池操作。